**Рамки:** Информационная система автоматизации поликлиники.

**Уровень:** Задача, определенная пользователем (приём пациента врачом).

**Основной исполнитель:** Врач.

**Заинтересованные лица и их требования:**

* Врач: Хочет быстро и точно внести результаты осмотра и факт приёма в систему. Требует сохранения данных без сбоев и получения подтверждения.
* Пациент: Хочет получить качественное лечение и документальное подтверждение визита. Ожидает своевременной информации о ходе записи.
* Администратор поликлиники: Желаeт иметь актуальные данные о посещениях для статистики и планирования. Требует корректного учета оказанных услуг.
* Медицинская организация: Требует надежного хранения медицинской информации, автоматической передачи данных в учёт и соответствия нормативам.
* Государственные органы здравоохранения: Заинтересованы в достоверных данных о посещении пациента и выставляемых медицинских услугах для отчетности и контроля.

**Предусловия:**

* Пациент зарегистрирован в системе и записан на приём к указанному врачу.
* Существуют объекты Patient и Appointment для данного визита.
* Врач вошёл в систему и приступает к проведению приёма.
* Необходимо вести медицинскую карту пациента.

**Постусловия:**

* Данные визита сохранены в медицинской карте (MedicalRecord) пациента.
* Статус приёма (Appointment) обновлён на «Завершён».
* При необходимости автоматически созданы соответствующие записи: обновлён график врача, история болезни.
* Сформированы и отправлены уведомления: врачу (подтверждение сохранения), пациенту (результаты осмотра и дальнейшие инструкции).
* Медицинская карта пациента активирована с учётом актуального статуса.

**Основной успешный сценарий:**
 1. Пациент приходит на приём к врачу (в назначенное время).
 2. Врач открывает запись текущего приёма (загружает Appointment из системы).
 3. Врач проводит осмотр/консультацию пациента.
 4. Врач вносит результаты осмотра в систему: указывает жалобы, диагноз и назначения (текстом или выбором из справочника).
 5. Система сохраняет введённые данные, автоматически создавая новую запись Visit в медицинской карте пациента и связывая её с текущим приёмом.
 6. Система обновляет статус приёма на «Завершён» и вычисляет необходимые сопутствующие операции.
 7. Система уведомляет врача об успешном сохранении данных (например, всплывающее сообщение «Данные визита сохранены»).
 8. Система отправляет уведомление пациенту (SMS/email/Push-уведомление) с результатами осмотра и дальнейшими инструкциями.
 9. Пациент получает отчёт о приёме (печатный или электронный) и покидает кабинет.

**Расширения (альтернативные потоки):**

*a.* В любой момент врач может переключиться в административный режим (например, для изменения статуса приёма или ввода экстренных данных).
  ``` 
  1. Система переходит в режим администратора при введении специального кода или подтверждения.
  2. Врач выполняет необходимые операции (изменяет статус приёма, корректирует данные и т.п.).
  3. Система возвращается в обычный режим проведения приёма.
  ```
*б.* При сбое системы (например, отключении питания или потере связи) должна быть обеспечена сохранность данных.
  ```
  1. Врач перезагружает систему, регистрируется заново, при необходимости восстанавливает прерванный приём (система предлагает восстановить предыдущее состояние).
  2. Система проверяет журнал транзакций, восстанавливает недозаписанные данные визита.
    2а. Если восстановление невозможно, система уведомляет об ошибке и предлагает заново ввести результаты (данные визита до сбоя сохраняются в журнале об ошибках).
  ```
*1a.* Если пациент передумал или не может продолжить приём (возникает досрочное завершение приёма):
  ```
  1. Врач отмечает приём как отменённый в системе.
    1а. Если данные о визите уже вводились, система сохраняет зафиксированные результаты как черновик.
  2. Система сигнализирует об отмене и освобождает время врача.
  3. При необходимости система генерирует уведомление об отмене визита пациенту.
  ```

*2a.* Если система не может найти запись приёма (например, введён неверный ID):
```
  1. Система отображает сообщение об ошибке «Приём не найден».
  2. Врач проверяет корректность ввода (существует ли запись в расписании на это время).
    2а. Если ввод неверен, врач повторяет попытку или обращается в регистратуру.
    2б. Если приём действительно отсутствует (пациент не записан), система позволяет создать новый приём вручную или отменить операцию.
```

*3a.* При незапланированных действиях в ходе приёма (например, вызвать на консультацию коллегу):
```
  1. Врач делает пометку в системе о привлечении дополнительного врача.
  2. Система временно приостанавливает текущую запись и позволяет возобновить её после завершения консультации.
```

*4a.* Если пациент требует коррекции записи или назначения непосредственно во время приёма:
```
  1. Врач вносит изменения (удаляет или добавляет назначения).
  2. Система сохраняет изменения и отображает обновлённую информацию.
```

*5a.* Если при отправке уведомления пациенту произошёл сбой (нет связи с SMS/email сервисом):
```
  1. Система фиксирует ошибку отправки и повторяет попытку (либо предлагает врачу сделать это позже).
  2. Врач уведомлён о проблеме и может сообщить пациенту вручную.
```

**Специальные требования:**

* Высокая отказоустойчивость: система должна сохранять все введённые данные в реальном времени, чтобы избежать потери при сбоях. Для этого предусмотрены периодические автосохранения.
* Защита персональных данных: доступ к медицинской карте и результатам визита осуществляется только по аутентификации врача и пациента. Хранение и передача данных должны быть зашифрованы.
* Интуитивный интерфейс: эргономичный UI для крупного экрана с учётом возможности быстрой работы с таблицами и формами. Интерфейс должен обеспечивать удобный ввод сложных медицинских данных (врачу важно видеть всю карту пациента).
* Локализация: поддержка нескольких языков интерфейса (например, русский/английский) при необходимости.
* Интеграция со сторонними системами: встроенная возможность подключения модулей для проверки полиса страхования, выписки электронных рецептов и отправки данных в региональный регистр.
* Время отклика: система должна оперативно обрабатывать ввод данных (до нескольких секунд на запись визита при средней нагрузке).

**Список технологий и типов данных:**

* Пациента идентифицируют по уникальному ID (штрихкоду полиса/карты пациента, QR-коду из медицинской карты или паспорту) с помощью считывающего устройства или ручного ввода.
* Аутентификация врача: по логину/паролю или смарт-карте (требование защищённого доступа).
* Медицинские данные (диагнозы, назначения) вводятся с помощью выпадающих списков и текстовых полей; используются стандартизированные коды заболеваний и ЛПУ.
* Подпись/подтверждение: врач подписывает запись визита электронной подписью, если это необходимо.

**Частота использования:** Постоянно в рабочие часы; каждый визит пациента фиксируется системой.

**Открытые вопросы:**

* Изучить требования законодательства о медицинском учёте и защите персональных данных, чтобы обеспечить соответствие хранения и обмена данными.
* Определить алгоритмы резервного копирования и восстановления данных (особенно при внезапных сбоях или работе в офлайн-режиме).
* Уточнить требования к процедуре идентификации пациента при записи и приёме (персональный код, СНИЛС, паспорт).
* Решить, как обрабатывать ввод дополнительных параметров пациента (рост, вес, аллергии) — должен ли врач вносить их вручную или система подтягивает из базы.
* Выяснить, требуется ли распечатывать бумажный отчёт о визите или достаточно электронных уведомлений.
* Исследовать возможность использования мобильных устройств (планшетов) для ввода данных прямо во время приёма.
* Уточнить, кто вносит результаты: только врач или может участвовать медсестра/администратор (роль в системе).
* Какова процедура внесения визита в реальном времени при большом потоке пациентов (например, несколько врачей одновременно).
* Какие типы уведомлений нужны (SMS, email, печать) и кто их получает.
